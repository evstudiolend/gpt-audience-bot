from fastapi import FastAPI, Request
from pydantic import BaseModel
from langchain.chat_models import ChatOpenAI
from langchain.chains import LLMChain
from langchain.prompts import PromptTemplate
import uvicorn
import os

app = FastAPI()

class InputData(BaseModel):
    question: str

# –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–ª—é—á API –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
openai_api_key = os.getenv("OPENAI_API_KEY")

# –°–æ–∑–¥–∞—ë–º LLMChain
llm = ChatOpenAI(model_name="gpt-4", temperature=0, openai_api_key=openai_api_key)

prompt = f"""
–¢—ã ‚Äî –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥-–∞–Ω–∞–ª–∏—Ç–∏–∫. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ü–µ–ª–µ–≤—É—é –∞—É–¥–∏—Ç–æ—Ä–∏—é –ø—Ä–æ–¥—É–∫—Ç–∞, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∏–∂–µ.

üîπ –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
"{user_input}"

üîπ –í—ã–ø–æ–ª–Ω–∏ –≥–ª—É–±–æ–∫–∏–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –ø–æ —Å–ª–µ–¥—É—é—â–µ–º—É –∞–ª–≥–æ—Ä–∏—Ç–º—É:

---

1. –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–µ—Ç–æ–¥–∏–∫–µ 5W:
- Who ‚Äî –∫—Ç–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å (–≤–æ–∑—Ä–∞—Å—Ç, –ø–æ–ª, –ø—Ä–æ—Ñ–µ—Å—Å–∏—è, –æ—Ç—Ä–∞—Å–ª—å, —Å–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ —Ç.–¥.)
- What ‚Äî —á—Ç–æ –º—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º (–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞, –µ–≥–æ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏)
- Why ‚Äî –∑–∞—á–µ–º –ø–æ–∫—É–ø–∞—é—Ç (–≤—ã–≥–æ–¥—ã, –º–æ—Ç–∏–≤–∞—Ü–∏—è, —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º)
- When ‚Äî –∫–æ–≥–¥–∞ –∏ –≤ –∫–∞–∫–∏—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö –Ω—É–∂–µ–Ω –ø—Ä–æ–¥—É–∫—Ç
- Where ‚Äî –≥–¥–µ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –∏ –∫–∞–∫ –ø—Ä–∏–≤–ª–µ—á—å —ç—Ç—É –∞—É–¥–∏—Ç–æ—Ä–∏—é

---

2. –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∞—É–¥–∏—Ç–æ—Ä–∏–∏:

–ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è:
- –†–µ–≥–∏–æ–Ω / –æ–±–ª–∞—Å—Ç—å / –≥–æ—Ä–æ–¥
- –ö–ª–∏–º–∞—Ç
- –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- –£—Ä–æ–≤–µ–Ω—å —É—Ä–±–∞–Ω–∏–∑–∞—Ü–∏–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∏—Ç–µ–ª–µ–π

–°–æ—Ü–∏–∞–ª—å–Ω–æ-–¥–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è:
- –ü–æ–ª
- –í–æ–∑—Ä–∞—Å—Ç
- –ü–æ–∫–æ–ª–µ–Ω–∏–µ
- –≠—Ç–∞–ø –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
- –†–æ–ª—å –≤ –¥–æ–º–æ—Ö–æ–∑—è–π—Å—Ç–≤–µ
- –ù–∞–ª–∏—á–∏–µ –∏ –≤–æ–∑—Ä–∞—Å—Ç –¥–µ—Ç–µ–π
- –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
- –°—Ñ–µ—Ä–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –¥–æ–ª–∂–Ω–æ—Å—Ç—å
- –£—Ä–æ–≤–µ–Ω—å –¥–æ—Ö–æ–¥–∞

–ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∞—è:
- –ü–æ–≤–æ–¥ –∫ –ø–æ–∫—É–ø–∫–µ
- –ì–ª–∞–≤–Ω—ã–µ –≤—ã–≥–æ–¥—ã
- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
- –ß–∞—Å—Ç–æ—Ç–∞ –ø–æ–∫—É–ø–∫–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –°—Ç–µ–ø–µ–Ω—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–µ
- –ö–∞–Ω–∞–ª—ã –∏ —Å–ø–æ—Å–æ–±—ã –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏—è
- –≠—Ç–∞–ø –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –ø—É—Ç–∏

–ü—Å–∏—Ö–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è (VALS):
- –¶–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–∏–ª—å –∂–∏–∑–Ω–∏
- –ñ–∏–∑–Ω–µ–Ω–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
- –ò—Å—Ç–æ—á–Ω–∏–∫ –≤–ª–∏—è–Ω–∏—è (—ç–∫—Å–ø–µ—Ä—Ç, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –¥—Ä—É–∑—å—è –∏ –¥—Ä.)
- –û—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ –∏–Ω–Ω–æ–≤–∞—Ü–∏—è–º

B2B (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ):
- –û—Ç—Ä–∞—Å–ª—å
- –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è –∫–æ–º–ø–∞–Ω–∏–∏
- –û–±—ä–µ–º –∑–∞–∫—É–ø–æ–∫
- –ì–µ–æ–≥—Ä–∞—Ñ–∏—è –∏ —Ñ–∏–ª–∏–∞–ª—ã
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–±–æ—Ä–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
- –£—Ä–æ–≤–µ–Ω—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–Ω–æ—Å—Ç–∏
- –û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã —Å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º–∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏
- –†–æ–ª–∏ –∑–∞–∫—É–ø–æ—á–Ω–æ–≥–æ –∫–æ–º–∏—Ç–µ—Ç–∞

---

3. –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã:
- –ü—Ä–æ–±–ª–µ–º—ã –∏ –±–æ–ª–∏
- –°—Ç—Ä–∞—Ö–∏ –∏ —Å–æ–º–Ω–µ–Ω–∏—è
- –¢–∏–ø–∏—á–Ω—ã–µ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –∏ –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–∫–∞–∑–∞
- –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–¥—É–∫—Ç–∞
- –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–¥–∞–≤—Ü–∞
- –û–∂–∏–¥–∞–Ω–∏—è –æ—Ç –ø—Ä–æ–¥—É–∫—Ç–∞
- –ö–∞–∫ –ø—Ä–µ–≤–∑–æ–π—Ç–∏ –æ–∂–∏–¥–∞–Ω–∏—è

---

4. –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ (–ø–µ—Ä—Å–æ–Ω—ã):
–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π 1‚Äì2 —Ç–∏–ø–æ–≤—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π —Å –¥–µ—Ç–∞–ª—è–º–∏: –∫—Ç–æ –æ–Ω–∏, —á–µ–º –∑–∞–Ω–∏–º–∞—é—Ç—Å—è, —á–µ–≥–æ –±–æ—è—Ç—Å—è, —á—Ç–æ —Ö–æ—Ç—è—Ç, –ø–æ—á–µ–º—É –∫—É–ø—è—Ç, —á—Ç–æ –∏—Ö –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç.

---

5. –ò—Ç–æ–≥–∏:
- –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥: –∫–∞–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —É—á–µ—Å—Ç—å –≤ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–µ
- –ö–∞–Ω–∞–ª—ã –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
- –¢–æ—á–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞
- –ö–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –¥–æ–≤–µ—Ä–∏–µ –∏ –≤—ã–¥–µ–ª–∏—Ç—å—Å—è –Ω–∞ —Ñ–æ–Ω–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤

---

–û—Ç–≤–µ—Ç –æ—Ñ–æ—Ä–º–∏ –ª–æ–≥–∏—á–Ω–æ, —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ, –±–µ–∑ "–≤–æ–¥—ã", –∫–∞–∫ –≤ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–º –æ—Ç—á—ë—Ç–µ. –ù–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π.
"""
)

chain = LLMChain(llm=llm, prompt=prompt)

@app.post("/analyze")
async def analyze(data: InputData):
    response = chain.run(data.question)
    return {"result": response}

if __name__ == "__main__":
    uvicorn.run(app, host="0.0.0.0", port=80)
