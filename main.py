from fastapi import FastAPI
from pydantic import BaseModel
from langchain.chat_models import ChatOpenAI
from langchain.chains import LLMChain
from langchain.prompts import PromptTemplate
import os

app = FastAPI()

class InputData(BaseModel):
    question: str

# –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–ª—é—á API –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
openai_api_key = os.getenv("OPENAI_API_KEY")

# –ü–æ–¥–∫–ª—é—á–∞–µ–º GPT-4 —á–µ—Ä–µ–∑ LangChain
llm = ChatOpenAI(model_name="gpt-4", temperature=0.7, openai_api_key=openai_api_key)

# –ù–æ–≤—ã–π –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø—Ä–æ–º—Ç
prompt_template = PromptTemplate(
    input_variables=["question"],
    template="""
–¢—ã ‚Äî –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥-–∞–Ω–∞–ª–∏—Ç–∏–∫. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ü–µ–ª–µ–≤—É—é –∞—É–¥–∏—Ç–æ—Ä–∏—é –ø—Ä–æ–¥—É–∫—Ç–∞, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∏–∂–µ:

üîπ –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
\"\"\"{question}\"\"\"

üîπ –í—ã–ø–æ–ª–Ω–∏ –≥–ª—É–±–æ–∫–∏–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –ø–æ —Å–ª–µ–¥—É—é—â–µ–º—É –∞–ª–≥–æ—Ä–∏—Ç–º—É:

1. –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–µ—Ç–æ–¥–∏–∫–µ 5W:
- Who ‚Äî –∫—Ç–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å (–≤–æ–∑—Ä–∞—Å—Ç, –ø–æ–ª, –ø—Ä–æ—Ñ–µ—Å—Å–∏—è, –æ—Ç—Ä–∞—Å–ª—å, —Å–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ —Ç.–¥.)
- What ‚Äî —á—Ç–æ –º—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º (–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç–∞)
- Why ‚Äî –∑–∞—á–µ–º –ø–æ–∫—É–ø–∞—é—Ç (–≤—ã–≥–æ–¥—ã, –º–æ—Ç–∏–≤–∞—Ü–∏—è)
- When ‚Äî –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω –ø—Ä–æ–¥—É–∫—Ç
- Where ‚Äî –≥–¥–µ –Ω–∞–π—Ç–∏ –∏ –∫–∞–∫ –ø—Ä–∏–≤–ª–µ—á—å —ç—Ç—É –∞—É–¥–∏—Ç–æ—Ä–∏—é

2. –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∞—É–¥–∏—Ç–æ—Ä–∏–∏:

–ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è:
- –†–µ–≥–∏–æ–Ω / –æ–±–ª–∞—Å—Ç—å / –≥–æ—Ä–æ–¥
- –ö–ª–∏–º–∞—Ç
- –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- –£—Ä–æ–≤–µ–Ω—å —É—Ä–±–∞–Ω–∏–∑–∞—Ü–∏–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∏—Ç–µ–ª–µ–π

–°–æ—Ü–∏–∞–ª—å–Ω–æ-–¥–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è:
- –ü–æ–ª
- –í–æ–∑—Ä–∞—Å—Ç
- –ü–æ–∫–æ–ª–µ–Ω–∏–µ
- –≠—Ç–∞–ø –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
- –†–æ–ª—å –≤ –¥–æ–º–æ—Ö–æ–∑—è–π—Å—Ç–≤–µ
- –ù–∞–ª–∏—á–∏–µ –∏ –≤–æ–∑—Ä–∞—Å—Ç –¥–µ—Ç–µ–π
- –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
- –°—Ñ–µ—Ä–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –¥–æ–ª–∂–Ω–æ—Å—Ç—å
- –£—Ä–æ–≤–µ–Ω—å –¥–æ—Ö–æ–¥–∞

–ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∞—è:
- –ü–æ–≤–æ–¥ –∫ –ø–æ–∫—É–ø–∫–µ
- –ß–∞—Å—Ç–æ—Ç–∞ –ø–æ–∫—É–ø–∫–∏
- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
- –°—Ç–µ–ø–µ–Ω—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–µ
- –ö–∞–Ω–∞–ª—ã –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏—è
- –≠—Ç–∞–ø –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –ø—É—Ç–∏

–ü—Å–∏—Ö–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è:
- –¶–µ–Ω–Ω–æ—Å—Ç–∏
- –°—Ç–∏–ª—å –∂–∏–∑–Ω–∏
- –û—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ –∏–Ω–Ω–æ–≤–∞—Ü–∏—è–º

B2B (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ):
- –û—Ç—Ä–∞—Å–ª—å
- –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è –∫–æ–º–ø–∞–Ω–∏–∏
- –û–±—ä–µ–º –∑–∞–∫—É–ø–æ–∫
- –ì–µ–æ–≥—Ä–∞—Ñ–∏—è
- –†–æ–ª–∏ –∑–∞–∫—É–ø–æ—á–Ω–æ–≥–æ –∫–æ–º–∏—Ç–µ—Ç–∞
- –£—Ä–æ–≤–µ–Ω—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–Ω–æ—Å—Ç–∏

3. –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã:
- –ë–æ–ª–∏ –∏ –ø—Ä–æ–±–ª–µ–º—ã
- –°—Ç—Ä–∞—Ö–∏ –∏ —Å–æ–º–Ω–µ–Ω–∏—è
- –¢–∏–ø–∏—á–Ω—ã–µ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã
- –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ –∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
- –û–∂–∏–¥–∞–Ω–∏—è –∏ –∫–∞–∫ –∏—Ö –ø—Ä–µ–≤–∑–æ–π—Ç–∏

4. –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ (–ø–µ—Ä—Å–æ–Ω—ã):
–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π 1‚Äì2 —Ç–∏–ø–æ–≤—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —Å –¥–µ—Ç–∞–ª—è–º–∏: –∫—Ç–æ –æ–Ω–∏, —á–µ–º –∑–∞–Ω–∏–º–∞—é—Ç—Å—è, —á–µ–≥–æ –±–æ—è—Ç—Å—è, —á—Ç–æ —Ö–æ—Ç—è—Ç, –ø–æ—á–µ–º—É –∫—É–ø—è—Ç, —á—Ç–æ –∏—Ö –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç.

5. –ò—Ç–æ–≥–∏:
- –ö—Ä–∞—Ç–∫–∏–µ –≤—ã–≤–æ–¥—ã
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
- –ö–∞–Ω–∞–ª—ã –∏ —Ç–æ—á–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞
- –ö–∞–∫ –≤—ã–¥–µ–ª–∏—Ç—å—Å—è –∏ –∑–∞–≤–æ–µ–≤–∞—Ç—å –¥–æ–≤–µ—Ä–∏–µ

–û—Ñ–æ—Ä–º–∏ –æ—Ç–≤–µ—Ç –ª–æ–≥–∏—á–Ω–æ, —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ, –±–µ–∑ –≤–æ–¥—ã, –∫–∞–∫ –≤ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–º –æ—Ç—á—ë—Ç–µ.
"""
)

# –°–æ–∑–¥–∞—ë–º —Ü–µ–ø–æ—á–∫—É
chain = LLMChain(prompt=prompt_template, llm=llm)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–∞
@app.post("/")
async def analyze(data: InputData):
    result = chain.run(question=data.question)
    return {"answer": result}
